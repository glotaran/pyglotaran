type: kinetic

options:
  iterations: 10
  gradient: finite_difference      # default
  method: non_linear_least_squares # default
  temperature: 293

datasets:
    - label: set1
      megacomplexes: [cmplx3]
      path: 'set1.ascii' #relative path
      absorption_vector_index: 1 # refers to the first element in the absorption_vectors list
      irf: irf1      
      scalings:
        - megacomplexes: [cmplx3] # optional
          compartments: [5, 6]
          parameter: 75 # 75th parameter
        - [[cmplx3], [8,9], 76] # alternative, order matters!
    - label: set2
      megacomplexes: [cmplx4]
      path: 'c:/myexp/set2.ascii' # absolutepath win
      absorption_vector_index: 1 # index one in the parameter vector
      scalings:
        - megacomplexes: [cmplx4] # optional
          compartments: [5, 6]
          parameter: 77 # 77th parameter
        - [[cmplx4], [8,9], 78] # alternative, order matters!
        
irf_parameter: #specific to kinetic or spectro_temporal model
  - label: irf1
    type: gaussian
    center: 1
    width: 2
    dispersion: [3] # dispersion is of 1st order
    normalize: true
  - [irf2, gaussian, 4, 2, [3], true] # compact
  - label: irf3
    type: gaussian
    center: [1, 4] # multiple gaussians
    width: [2, 5]
    dispersion: [3] # dispersion is of 1st order
    width_dispersion: [4] # dispersion is of 1st order
    normalize: true
  - label: irf4
    type: gaussian
    center: 1 # double gaussian
    width: [2, 5]
    dispersion: [3] # dispersion is of 1st order
    normalize: true

absorption_vectors: #equal to the total number of compartments
  - absorption_vector: [71,2,2,2,73,74,2,74,73,72,2,2,2] #these are indices in the total prameter vector
    
# Convention matrix notation column = source, row = target compartment
# (2,1) means from 1 to 2
k_matrices:
  - label: km1
    matrix: {
      (1,1): 11
      (2,1): 12
      (1,2): 13
      (3,1): 15
      (1,3): 16
      (4,1): 17
      (1,4): 18
}

# The input vector for a megacomplex is determined in the following way:
# first take the relevant absorption_vector
# then apply the dataset specific scaling parameters
# Example:
# cmplx3:
# Step 1: [71,2,2,2,73,74,2,74,73,72,2,2,2]
# Step 2: [71,2,2,2,73*75,74*75,2,74,73,72,2,2,2]
megacomplexes:
    - label: cmplx1
      k_matrices: [km1] # A megacomplex has one or more k-matrices
    - label: cmplx2
      k_matrix: km1
    - [cmplx3, [km1]]
    
compartment_constrains:
  - type: zero
    compartment: 5
    intervals: [(799.99, 800.00), (1,100)]
  - [zero, 2, [(1,683)]]
  - type: equal
    compartment: 5
    target: 9
    intervals: [(60, 799.99)]
    parameter: 54 # usually fixed
  - type: equal_area
    compartment: 3
    target: 1
    intervals: [(670, 810)]
    parameter: 55 # usually fixed
    weight: 0.0016
    # The area under the spectrum of the 3rd component parameter 55 times the area under the 1st component, from wavelength 670 to 810 is added as penalty to the residual with weight 0.0016

parameter_constraints:
  - type: fix
    parameters: [1, 2, 3, 54] # fix some parameters
  - type: bound
    range: (100, 150) # range of parameters
    lower: 0 # no upper specified => no upper bound

relations:
  - parameter: 86
    to: {const: 0, 89: 1, 90: 1, 87: -1.0} #Theta86 = 0 +1*theta89 + 1*theta90 -1*theta87
  - [80, {83: 1, 84: 1, 81: -1.0}]
  - [57, 30] # equality
                
parameters:
  - 4.13E-02
  - 0
  - 3.26E-02
  - 1
  - 0.282372206
  - 0.471888155
  - 0.245739639
  - 0.593186915
  - 0.124440894
  - 7.33E-03
  - 2.60E-02
  - 6.33E-02
  - 2.29E-02
  - 3.20E-04
  - 2.98E-02
  - 6.40E-03
  - 9.40E-03
  - 7.92E-04
  - 4.48E-03
  - 1.71E-03
  - 2.36E-02
  - 1.04E-02
  - 1.71E-03
  - 5.61E-04
  - 3.19E-03
  - 3.00E-03
  - 1.13E-03
  - 2.00E-04
  - 1.05E-05
  - 0
  - 2.34E-02
  - 7.78E-03
  - 1.71E-03
  - 1.90E-04
  - 2.00E-04
  - 4.38E-04
  - 1.13E-03
  - 2.00E-04
  - 1.05E-05
  - 1.17E-02
  - 1.95E-02
  - 1.01E-02
  - 1.71E-03
  - 0
  - 2.97E-03
  - 1.13E-03
  - 0
  - 3.07E-02
  - 1.54E-02
  - 9.20E-03
  - 1.93E-02
  - 4.05E-03
  - 1.71E-03
  - 0
  - 2.00E-04
  - 1.13E-03
  - 0
  - 5.57E-02
  - 1.54E-02
  - 1.43E-02
  - 3.80E-03
  - 2.94E-03
  - 3.28E-03
  - 3.62E-03
  - 1.30E-03
  - 2.40E-03
  - 2.42E-04
  - 2.00E-04
  - 7.39E-08
  - 1.43E-02
  - 37.349247
  - 14.7561779
  - 28.2267494
  - 23.9468117
  - 0.812765062
  - 2.61E-04
  - 0.521364272
  - 0.291661322
  - 3.83E-02
  - 0.567508638
  - 2.48E-02
  - 5.89E-03
  - 0.40580532
  - 0.186455578
  - 0.266385913
  - 0.754343867
  - 0.210361451
  - 0.744271636
  - 0.480900943
  - 0.483804375
  - 1.00100005
  - 1.00100005
  - 0.254867494
  - 1.99E-02
  - 0.254867494
  - 1.99E-02
  - 1.64E-02
  - 2.02E-04
  - 2.04E-05
  - 9.19E-04
  - 0.251684338
  - 0.404168457
  - 0.339916825
  - 0.465338051
  - 0.287414491
  - 0.456670791
  - 8.32E-02
  - 0.314546913
  - 6.70E-02
  - 0.317520976
  - 0.119261652
  - 0.354417086
  - 1.78E-03
  - 8.61E-04
  - 4.37E-04
  - 4.69E-05
  - 5.44E-05
  - 16.2107658
  - 119
  - 1
  - 1
  - 1
  - 1.78E-03
  - 8.61E-04
  - 4.37E-04
  - 4.69E-05
  - ["spectral_eqality" ,1]
  - 21.3688164
  - 0.363852113
  - 46.1332283
  - 0.121402621
  - 34.0707397
  - 0.156415582
  - 100.811073
  - 4.27E-03
  - 9.44886112
  - 101.28968
  - 99.0561752
  - 98.6576996
  - 100.503639
  - 100.196815
  - 98.9196472
  - 99.3605042
  - 8.94378376
  - 1.11250269
  - 0.445884764
  - 0.498221338
  - 0.16471681
  - 0.180820554
  - 0.182545677
  - 0.139947399
